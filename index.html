<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuidador de Idosos</title>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getStorage } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAexCf7hPN2OQvfsw66UDpci6nycivrK98",
            authDomain: "void-activation-system.firebaseapp.com",
            databaseURL: "https://void-activation-system-default-rtdb.firebaseio.com",
            projectId: "void-activation-system",
            storageBucket: "void-activation-system.firebasestorage.app",
            messagingSenderId: "108268095097",
            appId: "1:108268095097:web:4f45ff75a9e528b3f0f6a8",
            measurementId: "G-P71BZFRDQB"
        };

        const app = initializeApp(firebaseConfig);
        window.firebaseDb = getDatabase(app);
        window.firebaseAuth = getAuth(app);
        window.firebaseStorage = getStorage(app);
        window.firebaseRef = ref;
        window.firebaseOnValue = onValue;
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ===== LOGIN STYLES ===== */
        #loginView {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 64px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 28px;
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-login, .btn-save {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover, .btn-save:hover {
            background: #5568d3;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .demo-info {
            background: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 13px;
            color: #4a5568;
        }

        /* ===== DASHBOARD STYLES ===== */
        #dashboardView {
            background: #f7fafc;
            min-height: 100vh;
        }

        .navbar {
            background: #667eea;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 600;
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .btn-add {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .elderly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .elderly-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .elderly-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .elderly-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .elderly-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .elderly-info h3 {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .elderly-age {
            color: #718096;
            font-size: 14px;
        }

        .elderly-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .elderly-status.active {
            background: #d4edda;
            color: #155724;
        }

        .elderly-status.inactive {
            background: #fed7d7;
            color: #c53030;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .elderly-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: #f7fafc;
            padding: 10px;
            border-radius: 8px;
        }

        .stat-label {
            font-size: 11px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .elderly-actions {
            display: flex;
            gap: 10px;
        }

        .btn-view, .btn-edit {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-view {
            background: #667eea;
            color: white;
        }

        .btn-edit {
            background: #e2e8f0;
            color: #4a5568;
        }

        /* ===== MONITORING STYLES ===== */
        #monitoringView {
            background: #667eea;
            min-height: 100vh;
            padding: 20px;
        }

        .monitoring-container {
            max-width: 480px;
            margin: 0 auto;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
        }

        .sync-indicator.connected { color: #155724; border-left: 4px solid #28a745; }
        .sync-indicator.syncing { color: #856404; border-left: 4px solid #ffc107; }
        .sync-indicator.error { color: #721c24; border-left: 4px solid #dc3545; }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .monitoring-header {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .profile-info h2 {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.inactive {
            background: #fed7d7;
            color: #c53030;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        .status.inactive .status-indicator {
            animation: none;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 14px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .card-value {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-subtitle {
            font-size: 14px;
            color: #a0aec0;
            margin-top: 5px;
        }

        .falls-list {
            margin-top: 15px;
        }

        .fall-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #e53e3e;
        }

        .fall-date {
            font-size: 14px;
            color: #4a5568;
            font-weight: 500;
        }

        .fall-time {
            font-size: 12px;
            color: #a0aec0;
        }

        .fall-severity {
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .fall-severity.low { background: #fed7d7; color: #c53030; }
        .fall-severity.medium { background: #feebc8; color: #c05621; }
        .fall-severity.high { background: #e53e3e; color: white; }

        .locate-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #667eea;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .modal-icon {
            font-size: 48px;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #718096;
            cursor: pointer;
        }

        .modal-content {
            margin-bottom: 25px;
        }

        .modal-info-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .modal-info-label {
            font-size: 12px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .modal-info-value {
            font-size: 16px;
            color: #2d3748;
            font-weight: 500;
        }

        .modal-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }

        .modal-button:hover {
            background: #5568d3;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ===== LOGIN VIEW ===== -->
    <div id="loginView" class="view active">
        <div class="login-container">
            <div class="logo">
                <div class="logo-icon">üë¥</div>
                <h1>Cuidador de Idosos</h1>
                <p class="subtitle">Sistema de Monitoramento</p>
            </div>

            <div id="errorMessage" class="error-message">
                Usu√°rio ou senha incorretos!
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label>üë§ Usu√°rio</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio" required>
                </div>

                <div class="form-group">
                    <label>üîí Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>

                <button type="submit" class="btn-login">Entrar</button>
            </form>

            <div class="demo-info">
                <strong>üîë Credenciais de Teste:</strong><br>
                Usu√°rio: <strong>herick</strong><br>
                Senha: <strong>1234</strong>
            </div>
        </div>
    </div>

    <!-- ===== DASHBOARD VIEW ===== -->
    <div id="dashboardView" class="view">
        <div class="navbar">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <span>üë¥</span>
                    <span>Cuidador de Idosos</span>
                </div>
                <div class="navbar-user">
                    <span>üë§ <span id="usernameDisplay">Herick</span></span>
                    <button class="btn-logout" onclick="app.logout()">üö™ Sair</button>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="header">
                <h1>Idosos Cadastrados</h1>
                <button class="btn-add" onclick="app.openAddModal()">
                    <span>‚ûï</span>
                    <span>Adicionar Idoso</span>
                </button>
            </div>

            <div class="elderly-grid">
                <div class="elderly-card">
                    <div class="elderly-header">
                        <div class="elderly-avatar">üë¥</div>
                        <div class="elderly-info">
                            <h3>Jos√© Silva</h3>
                            <p class="elderly-age">75 anos</p>
                        </div>
                    </div>

                    <div class="elderly-status active">
                        <span class="status-dot"></span>
                        <span>Ativo</span>
                    </div>

                    <div class="elderly-stats">
                        <div class="stat-item">
                            <div class="stat-label">üìä Passos</div>
                            <div class="stat-value">3,847</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">‚ö†Ô∏è Quedas</div>
                            <div class="stat-value">3</div>
                        </div>
                    </div>

                    <div class="elderly-actions">
                        <button class="btn-view" onclick="app.showMonitoring()">üëÅÔ∏è Monitorar</button>
                        <button class="btn-edit" onclick="app.openEditModal()">‚úèÔ∏è Editar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MONITORING VIEW ===== -->
    <div id="monitoringView" class="view">
        <button class="back-btn" onclick="app.showDashboard()">
            <span>‚Üê</span>
            <span>Voltar</span>
        </button>

        <div id="syncIndicator" class="sync-indicator syncing">
            <div class="sync-dot"></div>
            <span>Conectando...</span>
        </div>

        <div class="monitoring-container">
            <div class="monitoring-header">
                <div class="profile-section">
                    <div class="avatar">üë¥</div>
                    <div class="profile-info">
                        <h2 id="elderName">Jos√© Silva</h2>
                        <div class="status active" id="statusBadge">
                            <span class="status-indicator"></span>
                            <span>Ativo</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üë§ Informa√ß√µes Pessoais</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üéÇ Idade</div>
                        <div class="modal-info-value" id="idade">75 anos</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üìû Emerg√™ncia</div>
                        <div class="modal-info-value" id="telefoneEmergencia" style="font-size: 14px;">+55 48 99999-9999</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0; grid-column: 1 / -1;">
                        <div class="modal-info-label">üë®‚Äçüë©‚Äçüëß Contato</div>
                        <div class="modal-info-value" id="contatoEmergencia">Maria Silva (Filha)</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0; grid-column: 1 / -1;">
                        <div class="modal-info-label">üè• Plano de Sa√∫de</div>
                        <div class="modal-info-value" id="planoSaude">Unimed</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìä Atividade F√≠sica</div>
                <div class="card-value">
                    <span id="dailySteps">3,847</span>
                    <span style="font-size: 18px; color: #48bb78;">passos</span>
                </div>
                <div class="card-subtitle">Meta: <span id="metaPassos">5,000</span> passos (<span id="percentualMeta">77</span>%)</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 77%;" id="stepsProgress"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üî• Calorias</div>
                        <div class="modal-info-value" id="calorias">154 kcal</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üìè Dist√¢ncia</div>
                        <div class="modal-info-value" id="distancia">2.69 km</div>
                    </div>
                </div>
                <div class="card-subtitle" style="margin-top: 10px;">
                    √öltima atualiza√ß√£o: <span id="ultimaAtualizacao">H√° 2 min</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üíä Sa√∫de e Medicamentos</div>
                <div class="modal-info-item" style="background: #e6f7ff; border-left: 4px solid #1890ff;">
                    <div class="modal-info-label">üè• Condi√ß√µes M√©dicas</div>
                    <div class="modal-info-value" id="condicoesMedicas">Hipertens√£o, Diabetes Tipo 2</div>
                </div>
                <div style="margin-top: 10px;">
                    <div class="modal-info-label" style="margin-bottom: 8px;">üíä Medicamentos</div>
                    <div id="medicamentosList"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üì± Status do Dispositivo</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üîã Bateria</div>
                        <div class="card-value" style="font-size: 24px; color: #48bb78;">
                            <span id="bateria">85</span>%
                        </div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üì∂ WiFi</div>
                        <div class="card-value" style="font-size: 24px; color: #667eea;">
                            <span id="sinalWifi">-45</span> dBm
                        </div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üÜî Device ID</div>
                        <div class="modal-info-value" id="deviceId" style="font-size: 12px;">MAC_ADDRESS</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">üåê IP</div>
                        <div class="modal-info-value" id="deviceIp">192.168.1.100</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">‚öôÔ∏è Firmware</div>
                        <div class="modal-info-value" id="versaoFirmware">1.0.0</div>
                    </div>
                    <div class="modal-info-item" style="margin: 0;">
                        <div class="modal-info-label">‚è±Ô∏è Uptime</div>
                        <div class="modal-info-value" id="uptime">3h 25m</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ö†Ô∏è Hist√≥rico de Quedas</div>
                <div class="card-value" style="font-size: 28px; color: #e53e3e;">
                    <span id="fallsCount">3</span>
                    <span style="font-size: 14px; color: #718096;">quedas nos √∫ltimos 30 dias</span>
                </div>
                
                <div class="falls-list" id="fallsList">
                    <div class="fall-item">
                        <div>
                            <div class="fall-date">10 Dez 2025</div>
                            <div class="fall-time">14:32</div>
                        </div>
                        <div class="fall-severity low">Leve</div>
                    </div>
                </div>
            </div>

            <button class="locate-btn" onclick="app.locateElder()">
                <span style="font-size: 24px;">üìç</span>
                <span>Localizar Idoso</span>
            </button>
        </div>
    </div>

    <!-- Modal Adicionar/Editar -->
    <div id="elderlyModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Adicionar Idoso</h2>
                <button class="btn-close" onclick="app.closeModal('elderlyModal')">√ó</button>
            </div>

            <form id="elderlyForm">
                <div class="form-group">
                    <label>üë§ Nome Completo</label>
                    <input type="text" id="elderlyName" placeholder="Ex: Maria Silva" required>
                </div>

                <div class="form-group">
                    <label>üéÇ Idade</label>
                    <input type="number" id="elderlyAge" placeholder="Ex: 75" required>
                </div>

                <div class="form-group">
                    <label>üìû Telefone de Emerg√™ncia</label>
                    <input type="tel" id="elderlyPhone" placeholder="Ex: +55 48 99999-9999" required>
                </div>

                <div class="form-group">
                    <label>üë®‚Äçüë©‚Äçüëß Contato de Emerg√™ncia</label>
                    <input type="text" id="elderlyContact" placeholder="Ex: Maria Silva (Filha)" required>
                </div>

                <div class="form-group">
                    <label>üè† Endere√ßo</label>
                    <input type="text" id="elderlyAddress" placeholder="Ex: Rua das Flores, 123" required>
                </div>

                <div class="form-group">
                    <label>üè• Plano de Sa√∫de</label>
                    <input type="text" id="elderlyInsurance" placeholder="Ex: Unimed" required>
                </div>

                <button type="submit" class="btn-save">üíæ Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal Localiza√ß√£o -->
    <div id="locationModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üó∫Ô∏è</div>
                <h2 class="modal-title">Localiza√ß√£o</h2>
            </div>
            <div class="modal-content">
                <div class="modal-info-item">
                    <div class="modal-info-label">üìç √öltima Localiza√ß√£o</div>
                    <div class="modal-info-value" id="locationText">Rua das Flores, 123</div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">üåê Coordenadas</div>
                    <div class="modal-info-value" id="locationCoords">Lat: -27.5954, Long: -48.5480</div>
                </div>
            </div>
            <button class="modal-button" onclick="app.openGoogleMaps()">üåç Abrir no Google Maps</button>
            <button class="modal-button" onclick="app.closeModal('locationModal')" style="background: #718096;">Fechar</button>
        </div>
    </div>

    <!-- Modal Alerta de Queda -->
    <div id="fallModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üö®</div>
                <h2 class="modal-title">Alerta de Queda</h2>
            </div>
            <div class="modal-content">
                <div class="modal-info-item">
                    <div class="modal-info-label">‚ö†Ô∏è Status</div>
                    <div class="modal-info-value">Queda detectada agora!</div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">üìç Localiza√ß√£o</div>
                    <div class="modal-info-value" id="fallLocation"></div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">üåê Coordenadas</div>
                    <div class="modal-info-value" id="fallCoords"></div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">üïê Hor√°rio</div>
                    <div class="modal-info-value" id="fallTime"></div>
                </div>
                <div class="modal-info-item" style="background: #fed7d7; border-left: 4px solid #e53e3e;">
                    <div class="modal-info-label" style="color: #c53030;">‚ö° A√ß√£o Recomendada</div>
                    <div class="modal-info-value" style="color: #c53030;">Verificar imediatamente!</div>
                </div>
            </div>
            <button class="modal-button" onclick="app.openFallGoogleMaps()">üåç Abrir no Google Maps</button>
            <button class="modal-button" onclick="app.closeModal('fallModal')" style="background: #718096;">Fechar</button>
        </div>
    </div>

    <script>
        // Aplica√ß√£o Principal
        const app = {
            currentUserData: null,
            updateCount: 0,
            userRef: null,
            lastAlertShown: null,
            alertModalOpen: false,
            lastFallCoords: { lat: -27.5954, lng: -48.5480 },
            lastUpdateTimestamp: null,
            statusCheckInterval: null,

            init() {
                console.log('üöÄ App inicializada');
                
                // Login form
                const loginForm = document.getElementById('loginForm');
                if (!loginForm) {
                    console.error('‚ùå loginForm n√£o encontrado!');
                    return;
                }
                
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    console.log('üìù Tentando fazer login...');
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    console.log('üë§ Username:', username);

                    if (username === 'herick' && password === '1234') {
                        console.log('‚úÖ Login bem-sucedido!');
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('username', username);
                        this.showDashboard();
                    } else {
                        console.log('‚ùå Credenciais inv√°lidas');
                        document.getElementById('errorMessage').classList.add('show');
                        setTimeout(() => {
                            document.getElementById('errorMessage').classList.remove('show');
                        }, 3000);
                    }
                });

                // Elderly form
                document.getElementById('elderlyForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    alert('‚úÖ Idoso salvo com sucesso!\n\n(Funcionalidade em desenvolvimento)');
                    this.closeModal('elderlyModal');
                });

                // Check if logged in
                if (localStorage.getItem('isLoggedIn') === 'true') {
                    this.showDashboard();
                }

                // Close modals on outside click
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                            if (modal.id === 'fallModal') {
                                this.alertModalOpen = false;
                            }
                        }
                    });
                });
            },

            showView(viewId) {
                document.querySelectorAll('.view').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(viewId).classList.add('active');
            },

            showDashboard() {
                this.showView('dashboardView');
                document.getElementById('usernameDisplay').textContent = 
                    localStorage.getItem('username') || 'Herick';
            },

            showMonitoring() {
                // Verificar status a cada 5 segundos
                if (this.statusCheckInterval) {
                    clearInterval(this.statusCheckInterval);
                }
                this.statusCheckInterval = setInterval(() => this.checkDeviceStatus(), 5000);
                this.showView('monitoringView');
                setTimeout(() => this.connectToFirebase(), 100);
            },if (this.statusCheckInterval) {
                    clearInterval(this.statusCheckInterval);
                }
                this.showView('loginView');
            },

            checkDeviceStatus() {
                if (!this.lastUpdateTimestamp) return;
                
                const now = Date.now();
                const timeSinceUpdate = now - this.lastUpdateTimestamp;
                const maxInactiveTime = 30000; // 30 segundos sem atualiza√ß√£o = desativado
                
                if (timeSinceUpdate > maxInactiveTime) {
                    const statusBadge = document.getElementById('statusBadge');
                    if (statusBadge) {
                        statusBadge.className = 'status inactive';
                        statusBadge.innerHTML = '<span class="status-indicator"></span><span>Desativado</span>';
                    }
                    this.updateSyncIndicator('error', 'Dispositivo sem resposta');
                }

            logout() {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                this.showView('loginView');
            },

            openAddModal() {
                document.getElementById('modalTitle').textContent = 'Adicionar Idoso';
                document.getElementById('elderlyForm').reset();
                document.getElementById('elderlyModal').classList.add('active');
            },

            openEditModal() {
                document.getElementById('modalTitle').textContent = 'Editar Idoso';
                document.getElementById('elderlyName').value = 'Jos√© Silva';
                document.getElementById('elderlyAge').value = '75';
                document.getElementById('elderlyPhone').value = '+55 48 99999-9999';
                document.getElementById('elderlyContact').value = 'Maria Silva (Filha)';
                document.getElementById('elderlyAddress').value = 'Rua das Flores, 123';
                document.getElementById('elderlyInsurance').value = 'Unimed';
                document.getElementById('elderlyModal').classList.add('active');
            },

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                if (modalId === 'fallModal') {
                    this.alertModalOpen = false;
                }
            },

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                if (modalId === 'fallModal') {
                    this.alertModalOpen = true;
                }
            },

            locateElder() {
                if (this.currentUserData && this.currentUserData.dadosTempoReal && this.currentUserData.dadosTempoReal.statusAtual) {
                    const statusAtual = this.currentUserData.dadosTempoReal.statusAtual;
                    document.getElementById('locationText').textContent = statusAtual.localizacaoAtual;
                    document.getElementById('locationCoords').textContent = 
                        `Lat: ${statusAtual.coordenadas.lat}, Long: ${statusAtual.coordenadas.lng}`;
                    this.lastFallCoords = statusAtual.coordenadas;
                }
                this.openModal('locationModal');
            },

            openGoogleMaps() {
                const url = `https://www.google.com/maps/search/?api=1&query=${this.lastFallCoords.lat},${this.lastFallCoords.lng}`;
                window.open(url, '_blank');
            },

            openFallGoogleMaps() {
                const url = `https://www.google.com/maps/search/?api=1&query=${this.lastFallCoords.lat},${this.lastFallCoords.lng}`;
                window.open(url, '_blank');
            },

            updateSyncIndicator(status, message) {
                const indicator = document.getElementById('syncIndicator');
                if (!indicator) return;
                indicator.className = 'sync-indicator ' + status;
                indicator.innerHTML = `<div class="sync-dot"></div><span>${message}</span>`;
            },
this.lastUpdateTimestamp = Date.now(); // Registrar timestamp da atualiza√ß√£o
                        
            connectToFirebase() {
                const db = window.firebaseDb;
                const ref = window.firebaseRef;
                const onValue = window.firebaseOnValue;

                if (!db || !ref || !onValue) {
                    console.error('Firebase n√£o inicializado');
                    setTimeout(() => this.connectToFirebase(), 100);
                    return;
                }

                this.updateSyncIndicator('syncing', 'Conectando...');
                this.userRef = ref(db, 'usuarios/jose_silva');

                onValue(this.userRef, (snapshot) => {
                    this.updateCount++;
                    
                    if (snapshot.exists()) {
                        this.currentUserData = snapshot.val();
                        const timestamp = new Date().toLocaleTimeString('pt-BR');
                        console.log(`‚úÖ Atualiza√ß√£o #${this.updateCount} √†s ${timestamp}`);
                        
                        this.updateSyncIndicator('connected', `Sincronizado - ${timestamp}`);
                        this.updateUIWithFirebaseData(this.currentUserData);
                    } else {
                        this.updateSyncIndicator('error', 'Usu√°rio n√£o encontrado');
                    }
                }, (error) => {
                    console.error('Erro ao buscar dados:', error);
                    this.updateSyncIndicator('error', 'Erro de conex√£o');
                });

                setInterval(() => this.forceUpdate(), 1000);
            },

            forceUpdate() {
                if (!this.userRef) return;
                
                window.firebaseOnValue(this.userRef, (snapshot) => {
                    if (snapshot.exists()) {
                        this.lastUpdateTimestamp = Date.now(); // Registrar timestamp da atualiza√ß√£o
                        this.currentUserData = snapshot.val();
                        this.updateUIWithFirebaseData(this.currentUserData);
                    }
                }, () => {}, { onlyOnce: true });
            },

            updateUIWithFirebaseData(data) {
                if (data.nome) document.getElementById('elderName').textContent = data.nome;
                if (data.idade) document.getElementById('idade').textContent = data.idade + ' anos';
                if (data.telefoneEmergencia) document.getElementById('telefoneEmergencia').textContent = data.telefoneEmergencia;
                if (data.contatoEmergencia) document.getElementById('contatoEmergencia').textContent = data.contatoEmergencia;
                if (data.planoSaude) document.getElementById('planoSaude').textContent = data.planoSaude;

                if (data.condicoesMedicas) {
                    document.getElementById('condicoesMedicas').textContent = data.condicoesMedicas.join(', ');
                }

                if (data.medicamentos) {
                    const medicamentosList = document.getElementById('medicamentosList');
                    medicamentosList.innerHTML = '';
                    Object.entries(data.medicamentos).forEach(([tipo, medicamento]) => {
                        medicamentosList.innerHTML += `
                            <div class="modal-info-item" style="margin: 5px 0;">
                                <div class="modal-info-label">${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</div>
                                <div class="modal-info-value">${medicamento}</div>
                            </div>
                        `;
                    });
                }

                if (data.dadosTempoReal) {
                    const { statusAtual, atividadeFisica, dispositivo, monitoramentoQuedas, alertas } = data.dadosTempoReal;

                    if (statusAtual) {
                        
                        // Verificar se h√° timestamp de √∫ltima atualiza√ß√£o
                        if (this.lastUpdateTimestamp) {
                            const timeSinceUpdate = Date.now() - this.lastUpdateTimestamp;
                            const maxInactiveTime = 30000; // 30 segundos
                            
                            if (timeSinceUpdate > maxInactiveTime || !statusAtual.ativo) {
                                statusBadge.className = 'status inactive';
                                statusBadge.innerHTML = '<span class="status-indicator"></span><span>Desativado</span>';
                            } else {
                                statusBadge.className = 'status active';
                                statusBadge.innerHTML = '<span class="status-indicator"></span><span>Ativo</span>';
                            }
                        } else {
                            statusBadge.className = statusAtual.ativo ? 'status active' : 'status inactive';
                            statusBadge.innerHTML = `<span class="status-indicator"></span><span>${statusAtual.ativo ? 'Ativo' : 'Desativado'}</span>`;
                        }
                        statusBadge.innerHTML = `<span class="status-indicator"></span><span>${statusAtual.ativo ? 'Ativo' : 'Inativo'}</span>`;
                        
                        if (statusAtual.bateria !== undefined) {
                            document.getElementById('bateria').textContent = statusAtual.bateria.toFixed(1);
                        }
                        if (statusAtual.sinalWifi !== undefined) {
                            document.getElementById('sinalWifi').textContent = statusAtual.sinalWifi;
                        }
                    }

                    if (dispositivo) {
                        if (dispositivo.id) document.getElementById('deviceId').textContent = dispositivo.id;
                        if (dispositivo.ip) document.getElementById('deviceIp').textContent = dispositivo.ip;
                        if (dispositivo.versaoFirmware) document.getElementById('versaoFirmware').textContent = dispositivo.versaoFirmware;
                        if (dispositivo.uptime) {
                            const hours = Math.floor(dispositivo.uptime / 3600);
                            const minutes = Math.floor((dispositivo.uptime % 3600) / 60);
                            document.getElementById('uptime').textContent = `${hours}h ${minutes}m`;
                        }
                    }

                    if (atividadeFisica) {
                        document.getElementById('dailySteps').textContent = (atividadeFisica.passosDiarios || 0).toLocaleString('pt-BR');
                        document.getElementById('metaPassos').textContent = (atividadeFisica.metaPassos || 5000).toLocaleString('pt-BR');
                        document.getElementById('percentualMeta').textContent = (atividadeFisica.percentualMeta || 0).toFixed(0);
                        document.getElementById('stepsProgress').style.width = (atividadeFisica.percentualMeta || 0) + '%';
                        
                        if (atividadeFisica.calorias !== undefined) {
                            document.getElementById('calorias').textContent = atividadeFisica.calorias.toFixed(0) + ' kcal';
                        }
                        if (atividadeFisica.distancia !== undefined) {
                            document.getElementById('distancia').textContent = atividadeFisica.distancia.toFixed(2) + ' km';
                        }
                        if (atividadeFisica.ultimaAtualizacao) {
                            document.getElementById('ultimaAtualizacao').textContent = atividadeFisica.ultimaAtualizacao;
                        }
                    }

                    if (monitoramentoQuedas) {
                        document.getElementById('fallsCount').textContent = monitoramentoQuedas.totalQuedas30Dias || 0;
                    }

                    if (alertas && alertas.quedaDetectada) {
                        if (alertas.horarioAlerta !== this.lastAlertShown && !this.alertModalOpen) {
                            console.log('üö® NOVO ALERTA DE QUEDA!');
                            this.lastAlertShown = alertas.horarioAlerta;
                            this.showFallAlert(alertas);
                        }
                    }
                }

                if (data.historicoQuedas) {
                    this.updateFallsList(data.historicoQuedas);
                }
            },

            updateFallsList(historicoQuedas) {
                const fallsList = document.getElementById('fallsList');
                fallsList.innerHTML = '';

                const quedas = Object.values(historicoQuedas).sort((a, b) => {
                    return new Date(b.data + ' ' + b.horario) - new Date(a.data + ' ' + a.horario);
                });

                quedas.slice(0, 5).forEach(queda => {
                    const severityMap = { 'Leve': 'low', 'Moderada': 'medium', 'Grave': 'high' };
                    const severity = severityMap[queda.intensidade] || 'low';
                    const dataFormatada = new Date(queda.data).toLocaleDateString('pt-BR', { 
                        day: '2-digit', month: 'short', year: 'numeric' 
                    });

                    fallsList.innerHTML += `
                        <div class="fall-item">
                            <div>
                                <div class="fall-date">${dataFormatada}</div>
                                <div class="fall-time">${queda.horario}</div>
                            </div>
                            <div class="fall-severity ${severity}">${queda.intensidade}</div>
                        </div>
                    `;
                });
            },

            showFallAlert(alertas) {
                this.lastFallCoords = {
                    lat: alertas.coordenadasQueda.lat,
                    lng: alertas.coordenadasQueda.lng
                };

                document.getElementById('fallLocation').textContent = alertas.localizacaoQueda;
                document.getElementById('fallCoords').textContent = 
                    `Lat: ${alertas.coordenadasQueda.lat}, Long: ${alertas.coordenadasQueda.lng}`;
                document.getElementById('fallTime').textContent = alertas.horarioAlerta;

                this.openModal('fallModal');
            }
        };

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM carregado');
            app.init();
        });
        
        console.log('üìú Script carregado');
    </script>
</body>
</html>
